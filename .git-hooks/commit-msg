#!/bin/bash
# Hive Project - Commit Message Hook
# Phase 2: Conventional Commits enforcement (currently disabled)

# ã“ã®ãƒ•ãƒƒã‚¯ã¯Phase 2ã§æœ‰åŠ¹åŒ–äºˆå®š
# ç¾åœ¨ã¯æƒ…å ±æä¾›ã®ã¿

set -e

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

echo "ğŸ“ ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æƒ…å ±ãƒ•ãƒƒã‚¯ (Phase 2ã§æœ¬æ ¼å®Ÿè£…äºˆå®š)"

# Conventional Commitså½¢å¼ã®ãƒã‚§ãƒƒã‚¯ï¼ˆç¾åœ¨ã¯è­¦å‘Šã®ã¿ï¼‰
commit_regex='^(feat|fix|docs|style|refactor|test|chore|ci)(\(.+\))?: .{1,50}'

if ! echo "$commit_msg" | grep -qE "$commit_regex"; then
    echo ""
    echo "ğŸ’¡ æ¨å¥¨: Conventional Commitså½¢å¼ã®ä½¿ç”¨"
    echo "   å½¢å¼: type(scope): description"
    echo ""
    echo "   ğŸ“‹ ã‚¿ã‚¤ãƒ—ä¾‹:"
    echo "   - feat(queen): add multi-agent coordination"
    echo "   - fix(comb): resolve file locking issue" 
    echo "   - docs(readme): update setup instructions"
    echo "   - refactor(workers): simplify prompt management"
    echo "   - test(basic): add integration tests"
    echo ""
    echo "   è©³ç´°: https://www.conventionalcommits.org/"
    echo ""
    echo "âš ï¸  æ³¨æ„: Phase 2ã§ã“ã®å½¢å¼ãŒå¿…é ˆã«ãªã‚Šã¾ã™"
    echo ""
fi

# ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é•·ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ï¼‰
if [ ${#commit_msg} -gt 72 ]; then
    echo "ğŸ’¡ æ¨å¥¨: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯72æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„"
    echo "   ç¾åœ¨: ${#commit_msg}æ–‡å­—"
    echo ""
fi

# æ—¥æœ¬èªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å ´åˆã®æ³¨æ„
if echo "$commit_msg" | grep -q '[ã²ã‚‰ãŒãªã‚«ã‚¿ã‚«ãƒŠæ¼¢å­—]'; then
    echo "ğŸ—¾ æ—¥æœ¬èªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
    echo "   ğŸ’¡ ã‚°ãƒ­ãƒ¼ãƒãƒ«é–‹ç™ºã‚’è€ƒæ…®ã—ã¦Englishã®ä½µè¨˜ã‚’æ¨å¥¨ã—ã¾ã™"
    echo ""
fi

echo "âœ… ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯å®Œäº† (æƒ…å ±æä¾›ãƒ¢ãƒ¼ãƒ‰)"

# Phase 2ã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–äºˆå®š:
# exit 0  # ç¾åœ¨ã¯å¸¸ã«æˆåŠŸ
# exit 1  # Phase 2ã§ã¯å½¢å¼é•åæ™‚ã«å¤±æ•—