#!/bin/bash
# Hive Project - Commit Message Hook
# Phase 2: Conventional Commits enforcement (currently disabled)

# このフックはPhase 2で有効化予定
# 現在は情報提供のみ

set -e

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

echo "📝 コミットメッセージ情報フック (Phase 2で本格実装予定)"

# Conventional Commits形式のチェック（現在は警告のみ）
commit_regex='^(feat|fix|docs|style|refactor|test|chore|ci)(\(.+\))?: .{1,50}'

if ! echo "$commit_msg" | grep -qE "$commit_regex"; then
    echo ""
    echo "💡 推奨: Conventional Commits形式の使用"
    echo "   形式: type(scope): description"
    echo ""
    echo "   📋 タイプ例:"
    echo "   - feat(queen): add multi-agent coordination"
    echo "   - fix(comb): resolve file locking issue" 
    echo "   - docs(readme): update setup instructions"
    echo "   - refactor(workers): simplify prompt management"
    echo "   - test(basic): add integration tests"
    echo ""
    echo "   詳細: https://www.conventionalcommits.org/"
    echo ""
    echo "⚠️  注意: Phase 2でこの形式が必須になります"
    echo ""
fi

# コミットメッセージ長チェック（警告のみ）
if [ ${#commit_msg} -gt 72 ]; then
    echo "💡 推奨: コミットメッセージは72文字以内にしてください"
    echo "   現在: ${#commit_msg}文字"
    echo ""
fi

# 日本語コミットメッセージの場合の注意
if echo "$commit_msg" | grep -q '[ひらがなカタカナ漢字]'; then
    echo "🗾 日本語コミットメッセージが検出されました"
    echo "   💡 グローバル開発を考慮してEnglishの併記を推奨します"
    echo ""
fi

echo "✅ コミットメッセージチェック完了 (情報提供モード)"

# Phase 2では以下のコードを有効化予定:
# exit 0  # 現在は常に成功
# exit 1  # Phase 2では形式違反時に失敗